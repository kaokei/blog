(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{355:function(s,t,e){"use strict";e.r(t);var a=e(1),n=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"api-文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api-文档"}},[s._v("#")]),s._v(" API 文档")]),s._v(" "),t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[s._v("本库是在"),t("RouterLink",{attrs:{to:"/pages/64784b/"}},[s._v("@kaokei/di")]),s._v("的基础上增加了若干新的 API，"),t("RouterLink",{attrs:{to:"/pages/64784b/"}},[s._v("@kaokei/di")]),s._v("提供的 API 都是可用的。")],1),s._v(" "),t("h2",{attrs:{id:"declareproviders"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#declareproviders"}},[s._v("#")]),s._v(" declareProviders")]),s._v(" "),t("div",{staticClass:"language-ts line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("declareProviders")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useClass"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useClass"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeOtherService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useValue"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" someServiceInstance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useExisting"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeOtherService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("useFactory")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dependService1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dependService2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dependService3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" someServiceInstance"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    deps"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DependService1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" DependService2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" DependService3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("本函数只能在 setup 函数中使用。建议在 setup 的第一行使用，至少也需要在 useService 函数之前使用，否则效果可能不符合预期。")]),s._v(" "),t("p",[s._v("因为当前组件可能依赖了多个服务，所以可以一次性定义多个服务的 provider，所以本函数的参数是一个数组。以上列出了 provider 的所有可能形式，每种 provider 代表了不同的生成服务的方式。")]),s._v(" "),t("p",[s._v("本函数的作用是在当前组件中关联一个 Injector，这个 Injector 中根据"),t("code",[s._v("providers")]),s._v("声明了"),t("code",[s._v("token")]),s._v("与对应的服务的关联关系。这样后续在使用"),t("code",[s._v("useService")]),s._v("的时候就能根据"),t("code",[s._v("token")]),s._v("找到对应的服务。")]),s._v(" "),t("p",[s._v("我们知道整个应用的所有组件会组成一颗组件树，本函数的作用就是在这颗组件树中的某些组件关联 Injector。这些 Injector 也会形成一颗类似的树形结构，这棵树的根部是一个"),t("code",[s._v("根Injector")]),s._v("。")]),s._v(" "),t("p",[s._v("当然正常情况下，Injector 的数量会比组件的数量少很多，因为并不是所有的组件都需要关联一个 Injector。")]),s._v(" "),t("p",[s._v("想象一下，如果整个应用中所有的服务都是不同的，都是全局单例的。那么我们可能不需要使用"),t("code",[s._v("declareProviders")]),s._v("，只要把所有服务都放到"),t("code",[s._v("根Injector")]),s._v("中即可。")]),s._v(" "),t("p",[s._v("但是如果我们想要实现服务实例的生命周期和某个组件保持一致，最常见的场景就是路由组件。那么显然我们应该把服务定义在对应的路由组件中，而不是在根 Injector 中。因为当路由组件销毁时，对应的 Inejctor 也会销毁，然后 Injector 中的服务的实例对象也会被销毁。反之如果所有服务都是放在全局的根 Injector 中，因为根组件是不会销毁的，所以根 Injector 也不会销毁，导致某些数据一直存在于根 Injector 中，但是这也许不是我们想要的。")]),s._v(" "),t("p",[s._v("除了控制服务实例的生命周期，另一个功能就是可以实现同一个服务的多例效果。显而易见如果我们在不同的组件中调用"),t("code",[s._v("declareProviders")]),s._v("，并且配置了同一个服务。那么在获取服务实例时就能得到同一个服务的不同实例，因为在不同的组件中是对应的不同的 Injector，就算是相同的服务，也会生成不同的实例对象。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[t("code",[s._v("declareProviders")]),s._v("只能在 setup 中使用，且在同一个 setup 中只能调用一次，且应该在最顶部调用。")])]),s._v(" "),t("h2",{attrs:{id:"useservice"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#useservice"}},[s._v("#")]),s._v(" useService")]),s._v(" "),t("div",{staticClass:"language-ts line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ts"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 示例1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" someService "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 示例2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("someService1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" someService2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" someService3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  SomeService1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  SomeService2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  SomeService3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 示例3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" someService "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  skip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  optional"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 示例4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" someService "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useService")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SomeService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  self"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  optional"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("只能在 setup 函数中使用。")]),s._v(" "),t("p",[s._v("我们可以一次获取单个服务的实例对象，也可以一次性获取多个服务的实例对象。")]),s._v(" "),t("p",[s._v("第一个参数是 token 或者 token 数组。而且可以指定第二个参数 options 对象来控制 useService 的解析过程。")]),s._v(" "),t("p",[s._v("useService 的作用非常类似"),t("RouterLink",{attrs:{to:"/pages/64784b/#inject"}},[s._v("@Inject")]),s._v("。尤其是第二个参数 options 对象，支持这些属性：")],1),s._v(" "),t("ul",[t("li",[s._v("self 对应装饰器@Self")]),s._v(" "),t("li",[s._v("skip 对应装饰器@Skip")]),s._v(" "),t("li",[s._v("optional 对应装饰器@Optional")])]),s._v(" "),t("p",[s._v("其实 useService 的作用是等价于装饰器"),t("code",[s._v("@Inject")]),s._v("的，只不过装饰器只能在类中使用，不能在函数上使用，所以只好额外提供一个 useService 函数在 setup 函数中使用。")]),s._v(" "),t("p",[s._v("比如在 angular 中，就不需要这样一个函数来获取实例。因为 angular 应用中组件和服务的形式只能是类，在组件类中可以直接使用@Inject 来注入服务或者其他组件。")]),s._v(" "),t("p",[s._v("但是在 Vue 中，Vue 组件的形式有两种，一种是类组件，这种情况我们也可以不使用 useService，可以直接使用@Inject 来注入服务；另一种情况则是 Option 组件，因为 Option 组件不是类，所以不能使用装饰器。只能使用 useService 这种类似 hooks 的方法类获取实例对象。")]),s._v(" "),t("p",[s._v("useService 非常优秀的一点就是返回值都是自带类型的，从而可以非常方便的使用"),t("code",[s._v(".")]),s._v("来知道这个服务有哪些属性和方法。")]),s._v(" "),t("p",[s._v("另外一点就是其返回值已经是 reactive 的，可以直接在 vue 模版中使用。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[t("code",[s._v("useService")]),s._v("只能在 setup 中使用，可以多次使用。")])]),s._v(" "),t("h2",{attrs:{id:"declarerootproviders"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#declarerootproviders"}},[s._v("#")]),s._v(" declareRootProviders")]),s._v(" "),t("p",[s._v("语法和"),t("code",[s._v("declareProviders")]),s._v("一致，只不过作用有所区别。")]),s._v(" "),t("p",[s._v("declareProviders 的作用是在调用的组件中关联一个 Injector，并声明一些 providres。但是"),t("code",[s._v("declareRootProviders")]),s._v("的作用是直接在根 Injector 中声明 providers。")]),s._v(" "),t("p",[s._v("declareProviders 只能在 setup 函数中调用，且只能调用一次，但是 declareRootProviders 没有这些限制。")]),s._v(" "),t("p",[t("RouterLink",{attrs:{to:"/pages/3a3a6b/"}},[s._v("为什么需要这个函数")])],1),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("注意到 declareRootProviders 声明的服务是全局的，那么后续通过"),t("code",[s._v("useService\b")]),s._v("也是可以使用到这些服务的。")])]),s._v(" "),t("h2",{attrs:{id:"userootservice"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#userootservice"}},[s._v("#")]),s._v(" useRootService")]),s._v(" "),t("p",[s._v("语法和"),t("code",[s._v("useService")]),s._v("一致，只不过作用有所区别。")]),s._v(" "),t("p",[s._v("useService 会从当前组件关联的 Injector 开始寻找对应的 Provider，如果没有找到，那么会从父组件关联的 Injector 中寻找，直到根 Injector 为止。")]),s._v(" "),t("p",[s._v("useRootService 则是直接从根 Injector 中寻找对应的 Provider。")]),s._v(" "),t("p",[s._v("useService 只能在 setup 函数中调用，但是 useRootService 没有这个限制。")]),s._v(" "),t("p",[t("RouterLink",{attrs:{to:"/pages/3a3a6b/"}},[s._v("为什么需要这个函数")])],1)])}),[],!1,null,null,null);t.default=n.exports}}]);