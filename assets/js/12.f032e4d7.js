(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{493:function(s,t,a){"use strict";a.r(t);var n=a(15),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"什么是-provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-provider"}},[s._v("#")]),s._v(" 什么是 Provider")]),s._v(" "),a("p",[s._v("在了解了"),a("RouterLink",{attrs:{to:"/pages/8dfb90/"}},[s._v("什么是服务")]),s._v("之后，Provider 非常容易理解。Provider 是一个对象，包含了"),a("code",[s._v("服务名")]),s._v("和"),a("code",[s._v("服务工厂")]),s._v("。")],1),s._v(" "),a("p",[s._v("服务名又叫作服务标识符，或者叫作"),a("code",[s._v("Token")]),s._v("。")]),s._v(" "),a("p",[s._v("服务工厂代表如何生产一个服务对象出来。")]),s._v(" "),a("h2",{attrs:{id:"_4-种不同的-provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-种不同的-provider"}},[s._v("#")]),s._v(" 4 种不同的 Provider")]),s._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" injector "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Injector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  SomeClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" someUseValueToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useValue"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'someValue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" someUseClassToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" someUseExistingToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    useExisting"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" AnotherExistingToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    provide"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" someUseFactoryToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("useFactory")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dep1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dep2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dep3"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" someValue\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    deps"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dep1Token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dep2Token"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dep3Token"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" service1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" injector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("SomeClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" service2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" injector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("someUseValueToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" service3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" injector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("someUseClassToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" service4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" injector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("someUseExistingToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" service5 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" injector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("someUseFactoryToken"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("上面代码看似有 5 种不同的 Provider，是因为第一种的"),a("code",[s._v("SomeClass")]),s._v("是一种简写的 Provider，完整版本的代码是这样的。")]),s._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  provide"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  useClass"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SomeClass"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("也就是说 SomeClass 既可以作为服务名，又可以作为服务工厂。这也是用类来定义服务的优点。")]),s._v(" "),a("p",[s._v("Provider 中的 provide 参数代表服务名，服务名是用于后续获取服务时提供的参数，也就是"),a("code",[s._v("injector.get(服务名)")]),s._v("。服务名基本可以是除了 Falsy 值以外的任意数据。常见的服务名有类，字符串，Symbol。")]),s._v(" "),a("p",[s._v("Provider 中的另一个"),a("code",[s._v("useXXX")]),s._v("属性定义了服务工厂，也就是定义了如何来生产一个服务对象。")]),s._v(" "),a("p",[s._v("目前这 4 种 Provider 是完全参考的 "),a("a",{attrs:{href:"https://angular.cn/guide/dependency-injection-providers",target:"_blank",rel:"noopener noreferrer"}},[s._v("Angular"),a("OutboundLink")],1),s._v(" 的概念。")]),s._v(" "),a("h3",{attrs:{id:"useclass"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#useclass"}},[s._v("#")]),s._v(" useClass")]),s._v(" "),a("p",[s._v("useClass 属性一定是一个类，本库会采用"),a("code",[s._v("new")]),s._v("关键字来生产一个服务对象。")]),s._v(" "),a("h3",{attrs:{id:"usevalue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usevalue"}},[s._v("#")]),s._v(" useValue")]),s._v(" "),a("p",[s._v("useValue 属性可以是任意数据，包括函数。因为它会直接返回该数据作为服务对象。")]),s._v(" "),a("h3",{attrs:{id:"useexisting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#useexisting"}},[s._v("#")]),s._v(" useExisting")]),s._v(" "),a("p",[s._v("useExisting 属性一定是一个已经声明的服务名。它的作用是用这个新的服务名来生成一个服务对象。")]),s._v(" "),a("h3",{attrs:{id:"usefactory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usefactory"}},[s._v("#")]),s._v(" useFactory")]),s._v(" "),a("p",[s._v("useFactory 属性一定是一个函数，该函数的返回值作为服务对象。该函数可以有若干参数，参数需要通过"),a("code",[s._v("deps")]),s._v("属性来定义，deps 是一个服务名数组。")])])}),[],!1,null,null,null);t.default=e.exports}}]);